"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var db=getDatabase();function select(n,t){var r,a,c,s,l,i="SELECT ",u=[],f={},p="",d=1;return new Promise(function(e,o){t&&(t.cols&&0<t.cols.length?i+=t.cols.replace(/,$/,""):i+="*",t.where?(s=getCondiciones(t,n)).error?o(s.error):(i+=" FROM ".concat(n," WHERE ").concat(s.complemento),f={consulta:i,valorVariables:s.valorVariables}):(i+=" FROM ".concat(n," "),f={consulta:i,valorVariables:[]}),e(f))}).then(function(n){return p=n.consulta,new Promise(function(e,o){d=1,t.group&&t.group.variables&&(p+="GROUP BY ",t.group.valores&&t.group.condiciones?(u=t.group.variables.replace(/,$/,"").split(","),a=t.group.condiciones.replace(/,$/,"").split(","),r=t.group.valores.replace(/__$/,"").split("__"),u.length==r.length&&u.length==a.length?u.forEach(function(e,o){p=(p+="".concat(u[o]," "))+"".concat(a[o]," "),l=_typeof(parseInt(r[o])),p+="number"==l?"".concat(r[o]):'"'.concat(r[o],'"'),d==u.length?p+="":p+=",",d++}):o("Faltan parametros en para agrupar con condicionales, deben ser la misma cantidad de variables\nvars: ".concat(u.length,"\ncondc:").concat(a.length,"\nvals:").concat(r.length,"\nseparacion: ___"))):p+=t.group.variables),t.order&&t.order.variables&&(p+=" ORDER BY ".concat(t.order.variables.replace(/,$/,"")),t.order.type&&(p+=" ".concat(t.order.type))),t.limit&&(t.limit.start||0==t.limit.start&&!1!==t.limit.start)&&(p+=" LIMIT ".concat(t.limit.start),t.limit.end&&(p+=", ".concat(t.limit.end))),p+=";",n.consulta=p,e(n)})}).then(function(t){return p=t.consulta,new Promise(function(n,o){db.transaction(function(e){e.executeSql(p,t.valorVariables,function(e,o){c=Object.keys(o.rows).map(function(e){return o.rows[e]}),n(c)})},function(e){o(e.message)})})})}function insert(e,n){var t=[];return new Promise(function(e,o){n.cols?e(n.cols.replace(/__$/,"").split("__")):o("No hay columnas para insertar.\n")}).then(function(n){return query="INSERT INTO ".concat(e," VALUES ("),t=[],n.forEach(function(e){"null"==e?(query+="?,",t.push(null)):(query+="?,",t.push(e))}),query=query.replace(/,$/,""),query+=");",new Promise(function(e,o){db.transaction(function(e){e.executeSql(query,t)},function(e){o(e.message)},function(){e(n)})})})}function update(a,c){var s="",r="";return new Promise(function(e,o){s+="Faltan cosas:\n";var n=0,t=0,r=0;c.cols?t=c.cols.replace(/__$/,"").split("__"):(s+="cols: No hay valores para modificar\n",n++),c.colsNames?(r=c.colsNames.replace(/,$/,"").split(","),t.length!==r.length&&(s+="Los parametros no tienen las mismas cantidades:\ncols: ".concat(t.length,"\ncolsNames: ").concat(r.length),n++)):(s+="colsNames: No hay nombre de columnas\n",n++),0<n?o(s):e(c.where?{valores:t,columnas:r,condicion:getCondiciones(c,a)}:{valores:t,columnas:r,condicion:""})}).then(function(t){return new Promise(function(e,o){var n;t.condicion.error?o(t.condicion.error):(r="UPDATE ".concat(a," SET "),t.columnas.forEach(function(e,o){r+=(0==o?"":", ").concat(e," = ?")}),o=t.valores,n=[],t.valores.forEach(function(e){n.push(e)}),t.condicion.complemento&&(r+=" WHERE "+t.condicion.complemento,t.condicion.valorVariables.forEach(function(e){n.push(e)})),e({consulta:r+=";",valores:n,dataReturn:o}))})}).then(function(t){return new Promise(function(n,o){db.transaction(function(e){e.executeSql(r,t.valores,function(e,o){n(o.rowsAffected)})},function(e){o(e.message)},function(){})})})}function deleteReg(n,t){var r,a={consulta:"",valores:[]},c="";return new Promise(function(e,o){c+="DELETE FROM ".concat(n," "),t.where&&((r=getCondiciones(t,n)).error?o(r.error):r.complemento&&(c+="WHERE ".concat(r.complemento),a.valores=r.valorVariables)),a.consulta=c,e(a)}).then(function(t){return new Promise(function(n,o){db.transaction(function(e){e.executeSql(c,t.valores,function(e,o){n(o.rowsAffected)})},function(e){o(e.message)},function(){})})})}function getCondiciones(e,o){var n="",t="",r="",a=1;return e.where.variables&&e.where.valores?(objectVars=e.where.variables.replace(/,$/,"").split(","),objectVals=e.where.valores.replace(/__$/,"").split("__"),e.where.condiciones&&(objectCond=e.where.condiciones.split(","),t=!0),objectVars.forEach(function(e,o){!objectVals[o]&&objectVals[o]<0&&(r="La cantidad de valores no corresponde a las variables enviadas, vars: ".concat(objectVars.length," vals: ").concat(objectVals.length)),n+=e+" ",0<t&&objectCond[o]?n+="".concat(objectCond[o]," "):n+="= ",n+="? ",objectVars.length>a&&(n+="AND "),a++}),objectVars.length==objectVals.length||(r="La cantidad de valores no corresponde a las variables enviadas, object.where.valores: ".concat(objectVars.length," object.where.variables: ").concat(objectVals.length)),{complemento:n,error:r,valorVariables:objectVals}):{error:r=e.where.variables||e.where.valores?"No existe variable o valor de object.where.valores o object.where.variables":""}}module.exports={select:select,insert:insert,update:update,deleteReg:deleteReg};